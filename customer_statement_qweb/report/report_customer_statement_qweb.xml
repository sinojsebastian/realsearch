<?xml version="1.0" encoding="utf-8"?>
<odoo>
	
	<template id="report_customerstatement">
		<t t-call="web.html_container">
			<t t-call="web.external_layout">
				<div class="page">
					<style>
						thead { display: table-header-group }
						tfoot { display: table-row-group }
						tr { page-break-inside: avoid } 
				</style>
					<t t-foreach="data" t-as="d">
							<div class="row">
									<div class="col-12">
										<center><strong><b> Statement of Account</b></strong></center>
										<center><strong><b>As on </b></strong><b><span t-esc="context_timestamp(datetime.datetime.now()).strftime(date_format)"/></b> </center>
									</div>
							</div>
							<t t-set="total_credit" t-value="0"/>
	                    	<t t-set="total_debit" t-value="0"/>
	                    	<t t-set="count" t-value="1"/>
							<t t-foreach="statement_data" t-as="module">
								<div class="row">
										<div class="col-6" align="left">
											<t t-if="count == 1">
												<b>Name:   <t t-esc="d['partner_id'][1]"/></b><br></br>
											</t>
											<b>Building:  <t t-if="module"> <t t-esc="module.building_id.name"/></t></b><br></br>
											<b>Module:   <t t-if="module"> <t t-esc="module.name"/> </t></b>
										</div>
										<t t-if="count == 1">
											<div class="col-6" align="right">
												<t t-if="d['from_date']">
													<b>From Date:  <t t-esc="datetime.datetime.strptime(d['from_date'], server_date).strftime(date_format)"/><br/></b>
												</t>
												<t t-if="d['to_date']">
													<b>To Date:  <t t-esc="datetime.datetime.strptime(d['to_date'], server_date).strftime(date_format)"/></b>
												</t>
												<t t-else="">
													<b>To Date:  <t t-esc="context_timestamp(datetime.datetime.now()).strftime(date_format)"/></b>
												</t>
												<!-- <t t-esc="context_timestamp(datetime.datetime.now()).strftime(date_format)"/> -->
											</div>
										</t>
								</div>
								<t t-set="count" t-value="count + 1"/>
								<div class="col-xs-12">
								    <t t-set="total_credit" t-value="0"/>
	                    			<t t-set="total_debit" t-value="0"/>
	                    			<t t-set="balance" t-value="0"/>
	                    			<t t-set="opening_balance" t-value="0"/>
									<table class="table table-bordered mb32">
										<thead style="display:table-header-group;">
											<tr>
												<th>Date</th>                    
												<th>Particulars</th>    
												<th>Invoice Description</th>                        
												<th>Debit</th>                        
												<th>Credit</th>                        
												<th>Balance</th>
												<th>Due on</th>
												<th>Overdue by days</th>                        
											</tr>
										</thead>
										<tbody>
						                    	<t t-foreach="statement_data[module]" t-as="data">
						                    		<t t-if="data">
						                    		<tr>
							               				<td width="11%">
								                			<strong>
								                			<t t-if="'date' in data and data['date']">
								                				<t t-esc="datetime.datetime.strptime(str(data['date']), server_date).strftime(date_format)"/>
								                				<!-- <t t-esc="data['date']"/>  -->
								                			</t>
								                			</strong>
								                		</td>
								                		<td width="16%">
								                			<strong>
								                				<t t-if="'ref' in data and data['ref']">
								                					<t t-esc="data['ref']" />
								                				</t>
								                			</strong>
									               		</td>
									               		<td width="16%">
								                			<strong>
								                				<t t-if="'description' in data and data['description']">
								                					<t t-esc="data['description']" />
								                				</t>
								                			</strong>
									               		</td>
									               		<td width ="7%" style="text-align:right">
								                			<strong>
								                				<t t-if="'debit' in data and data['debit']">
									                			    <t t-set="total_debit" t-value="total_debit+data['debit']"/>
									                				<t t-esc="'{0:,.3f}'.format(float('%.3f'%(data['debit'])))" /> 
									                			</t>
								                			</strong>
									               		</td>
									               		<td width ="7%" style="text-align:right">
								                			<strong>
								                				<t t-if="'credit' in data and data['credit']">
									                			    <t t-set="total_credit" t-value="total_credit+data['credit']"/>
									                				<t t-esc="'{0:,.3f}'.format(float('%.3f'%(data['credit'])))" /> 
									                			</t>
								                			</strong>
									               		</td>
									               		<td width ="7%" style="text-align:right">
								                			<strong>
								                				<t t-if="'open_balance' in data and data['open_balance']">
									                				<t t-set="opening_balance" t-value="data['open_balance']"/>
									                				<t style="text-align:right" t-esc="'{0:,.3f}'.format(float('%.3f'%(data['open_balance'])))" /> 
									                			</t>
								                			</strong>
									               		</td>
													   <td width ="11%">
								                			<strong>
								                			<t t-if="'due_date' in data and data['due_date']">
								                				<t t-esc="datetime.datetime.strptime(str(data['due_date']), server_date).strftime(date_format)"/>
								                			   <!--  <t t-esc="data['due_date']" />  -->
								                			</t>
								                			</strong>
									               		</td>
									               		<td width ="7%">
								                			<strong>
								                				<t t-if="'due_days' in data and data['due_days']">
								                					<t t-esc="data['due_days']" /> 
								                				</t>
								                			</strong>
									               		</td>
									               	</tr>
									               </t>
					                			</t>
	                    			     </tbody>
					
									</table>
								</div>
							</t>
							<div>
								<strong>
		                			<div style="text-align: center;">
		                				<span>Balance:</span>		                			
		                					<t t-if="total_credit &gt; total_debit">
		                						<t t-if="'open_balance' in data">
		                							<t t-esc="'{0:,.3f}'.format(float('%.3f'%(data['open_balance'])))" /> 
		                						</t>                						
		                						<span style ="font-size:12px">Cr</span>               						
		                					</t>
		                					<t t-if="total_credit &lt; total_debit">  
		                						<t t-if="'open_balance' in data">              						
		                							<t t-esc="'{0:,.3f}'.format(float('%.3f'%(data['open_balance'])))" /> 
		                						</t>                						
		                						<span style ="font-size:12px">Dr</span>
		                					</t>
		                					
		                					<t t-if="total_credit==0 and total_debit ==0">
		                						<t t-if="'open_balance' in data">
		                							<t t-esc="'{0:,.3f}'.format(float('%.3f'%(data['open_balance'])))" />   
		                						</t>              						
		                					</t>
		                					
		                					<t t-if="total_credit and total_debit &gt; 0 and total_debit == total_credit">               					
		                						<t t-set="balance" t-value="total_debit-total_credit"/> 
		                						<t t-esc="'{0:,.3f}'.format(float('%.3f'%(balance)))" /> 
		                					</t>								            								          
		                			</div>
	                			</strong>
                			
                			</div>
							
					</t>
				</div> 
			
			</t>
		</t>
	</template>
	
</odoo>








